---
title: "GitHub Actions: Enforce SHA Pinningã®æ³¨æ„ç‚¹ã¨ç¾çŠ¶ã®æœ€é©è§£"
emoji: "ğŸŒ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["GitHub Actions", "Security", "zennfes2025infra"]
published: true
publication_name: "moshjp"
---

:::message
ã“ã®è¨˜äº‹ã¯ 2025å¹´9æœˆ3æ—¥æ™‚ç‚¹ã®æƒ…å ±ã‚’ã‚‚ã¨ã«åŸ·ç­†ã•ã‚Œã¦ã„ã¾ã™ã€‚
:::

## TL;DR

- GitHub Actions ã« SHA commit pinning ã‚’å¼·åˆ¶ã§ãã‚‹"Enforce SHA Pinning"æ©Ÿèƒ½ãŒè¿½åŠ ã•ã‚ŒãŸ
  - `actions/checkout@v4` ã®ã‚ˆã†ãª Git tag/branch ã®æŒ‡å®šãŒã‚ã‚‹å ´åˆã¯ workflow ã®å®Ÿè¡ŒãŒåœæ­¢ã•ã‚Œã‚‹
- ãŸã ã—ã€local action ã«ãŠã‘ã‚‹æŒ™å‹•ãªã©ä½¿ã„å‹æ‰‹ã¯ã¾ã ã¾ã è’å‰Šã‚Š
- ç¾çŠ¶ã¯ Renovate ã‚„ pinact ãªã©ã®ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ„ãƒ¼ãƒ«ã§å¯¾å¿œã™ã‚‹ã®ãŒä¸¸ãã†

## Enforce SHA Pinningã¨ã¯

9æœˆã®å¤ã‚’ã¯ã˜ã‚ã¦çŸ¥ã£ãŸã®ã§åˆæŠ•ç¨¿ã§ã™ã€‚

å…ˆæ—¥ GitHub ã‹ã‚‰ Actions ã«ã¤ã„ã¦ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é–¢é€£ã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆãŒç™ºè¡¨ã•ã‚Œã¾ã—ãŸã€‚
ãã®ä¸­ã§"Enforce SHA Pinning"ã¨ã„ã†è¨­å®šãŒè¿½åŠ ã•ã‚Œã¦ã„ã¾ã™ã€‚

https://github.blog/changelog/2025-08-15-github-actions-policy-now-supports-blocking-and-sha-pinning-actions/#enforce-sha-pinning


ä»Šã¾ã§ã¯ GitHub è‡ªä½“ã‚‚ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å‘ä¸Šã®ãŸã‚ SHA pinning ã‚’æ¨å¥¨ã—ã¦ã„ãªãŒã‚‰ã‚‚[^1]ã€ãã‚Œã‚’å¼·åˆ¶ã™ã‚‹ãŸã‚ã«ã¯ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ„ãƒ¼ãƒ«ã«é ¼ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã—ãŸã€‚ä»Šå›ã®æ©Ÿèƒ½è¿½åŠ ã«ã‚ˆã‚Šã€SHA pinning ã‚’ GitHub built-in ã®è¨­å®šã§å¼·åˆ¶ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

```yaml
# OK âœ…
- uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2
# NG âŒ
# å®Ÿè¡Œã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã€errorã§workflowãŒèµ°ã‚‰ãªã„
- uses: actions/checkout@v4.2.2
```

:::message
SHA pinning ãŒå¼·ãæ„è­˜ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã£ãŸå‡ºæ¥äº‹ã¨ã—ã¦ã€tj-actions ã«ãŠã‘ã‚‹ä¾µå®³äº‹ä»¶ãŒã‚ã‚Šã¾ã™ã€‚ä»¥ä¸‹ã®è¨˜äº‹ã«è©³ã—ã„ã§ã™ã€‚

https://www.cisa.gov/news-events/alerts/2025/03/18/supply-chain-compromise-third-party-tj-actionschanged-files-cve-2025-30066-and-reviewdogaction
:::

æœ‰åŠ¹åŒ–ã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ã« workflow ã®å®Ÿè¡ŒãŒåœæ­¢ã•ã‚Œã¾ã™ï¼š

![å®Ÿè¡ŒãŒåœæ­¢ã—ã¦ã„ã‚‹workflowã®ç”»åƒ](/images/ban-unpinned-wf.png)

ãŸã ã—å®Ÿéš›ã«ä½¿ã£ã¦ã¿ãŸã¨ã“ã‚ã€æœ‰ç”¨ã§ã¯ã‚ã‚Šã¤ã¤ã‚‚ã„ãã¤ã‹æ°—ã«ãªã‚‹ç‚¹ã‚’è¦‹ã¤ã‘ãŸã®ã§ç´¹ä»‹ã—ã¦ã„ãã¾ã™ã€‚

## ç¾æ™‚ç‚¹ã§ã®æ³¨æ„ç‚¹

### SHAã®è‡ªå‹•ä¿®æ­£ãƒ»æ›´æ–°ã«ã¯ä»–ãƒ„ãƒ¼ãƒ«ãŒå¿…è¦

ã‚ãã¾ã§ä»Šå›ã® Enforce SHA Pinning è¨­å®šã¯ SHA pin ã•ã‚Œã¦ã„ãªã„ action ã®åˆ©ç”¨ã‚’ ban ã™ã‚‹ã®ã¿ã§ã€ãã®ä¿®æ­£ãƒ»æ›´æ–°ã«ã¯ä»–ãƒ„ãƒ¼ãƒ«ã‚’åˆ©ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

Renovate ã® `helpers:pinGitHubActionDigests`/`helpers:pinGitHubActionDigestsToSemver` ã‚„[pinact](https://github.com/suzuki-shunsuke/pinact)ãªã©ãŒã“ã‚Œã‚‰ã‚’å®Ÿç¾ã§ãã‚‹ä»£è¡¨çš„ãªãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

https://docs.renovatebot.com/presets-helpers/#helperspingithubactiondigests

https://github.com/suzuki-shunsuke/pinact

GitHub built-in ã¨å‘¼ã‚“ã§å·®ã—æ”¯ãˆãªã„ã§ã‚ã‚ã† Dependabot ã‚‚ SHA ã®æ›´æ–°ã«ã¯å¯¾å¿œã—ã¦ã„ã¾ã™ãŒã€æ—¢å­˜ã® tag ã‚’ä¿®æ­£ã™ã‚‹æ©Ÿèƒ½ã¯ç¾æ™‚ç‚¹ã§ã‚ã‚Šã¾ã›ã‚“ã€‚

### ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ã®composite actionã‚‚æ¤œæŸ»ã®å¯¾è±¡

Enforce SHA Pinning è¨­å®šã¯è¨­å®šã•ã‚ŒãŸ repository å†…ã ã‘ã§ãªãã€ãã“ã§å‘¼ã³å‡ºã•ã‚Œã¦ã„ã‚‹ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ã® composite action ã‚‚æ¤œæŸ»ã®å¯¾è±¡ã¨ãªã‚Šã¾ã™ã€‚

å®Ÿéš›ã€è‡ªåˆ†ãŒãƒ¡ãƒ³ãƒ†ãƒŠã‚’ã‚„ã£ã¦ã„ã‚‹ repository ã§è¨­å®šã‚’æœ‰åŠ¹åŒ–ã—ã¦ã¿ãŸã¨ã“ã‚ã€ã“ã®ã‚±ãƒ¼ã‚¹ã«é­é‡ã— workflow ãŒå›ã‚‰ãªããªã‚Šã¾ã—ãŸ[^2]ã€‚

[ã“ã¡ã‚‰ã®è¨˜äº‹](https://zenn.dev/ncdc/articles/github-actions-sha-pitfalls)ã§ç´¹ä»‹ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã«ã€ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ã® composite action ã§ SHA pin ã•ã‚Œã¦ã„ãªã„ action ã®åˆ©ç”¨ãŒã‚ã‚‹å ´åˆã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£çš„ãªæ‡¸å¿µã¯æ®‹ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

https://zenn.dev/ncdc/articles/github-actions-sha-pitfalls

:::message
ä¼¼ãŸè©±ã¨ã—ã¦ã€Docker ãƒ™ãƒ¼ã‚¹ã® action ã§ image tag ãŒ pin ã•ã‚Œã¦ã„ãªã„ã‚±ãƒ¼ã‚¹ãŒã‚ã‚Šã¾ã™ã€‚

æ”»æ’ƒè€…ãŒ registry ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’å–å¾—ã—ã¦ã—ã¾ãˆã°ã€ä¾‹ãˆã° `latest` ã®ã‚ˆã†ãª tag æŒ‡å®šã‚’ã—ã¦ã„ã‚‹ action ã¨ãã®åˆ©ç”¨è€…ã¯å½±éŸ¿ã‚’å—ã‘ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

ã“ã®ç‚¹ã«ã‚‚æ³¨æ„ã™ã¹ãã§ã—ã‚‡ã†ã€‚
:::

ãã†è€ƒãˆã‚‹ã¨ã“ã®ãƒ«ãƒ¼ãƒ«ã¯ã‚ˆã‚Šã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’å¼·å›ºã«ã™ã‚‹è‰¯ã„ã‚‚ã®ãªã®ã§ã™ãŒã€ä¸€æ–¹ã§ configurable ãªéƒ¨åˆ†ãŒå°‘ãªãä½¿ã„å‹æ‰‹ã®æ‚ªã„ã‚‚ã®ã«ãªã£ã¦ã„ã¾ã™ï¼ˆå¾Œè¿°ã—ã¾ã™ï¼‰ã€‚

ã¾ãŸã€ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ action ã®å ´åˆã€SHA pin ã™ã‚‹ã‚ˆã†ãªä¿®æ­£ã®åæ˜ ã«æ™‚é–“ãŒã‹ã‹ã‚Šå¾—ã‚‹ï¼ˆãã® action ã®ãƒ¡ãƒ³ãƒ†ãƒŠã«ä¾ã£ã¦ã—ã¾ã†ï¼‰ã®ã‚‚æ‡¸å¿µç‚¹ã§ã™ã€‚ç‹¬è‡ªã« fork ã™ã‚‹ãªã©å›é¿ç­–ã¯ã‚ã‚Šã¾ã™ãŒã€ã„ãšã‚Œã«ã›ã‚ˆã“ã‚Œã‚‰ã®å¯¾å¿œã«ã¯æ™‚é–“ãŒã‹ã‹ã‚‹å ´åˆã‚‚å¤šãã€ãã®é–“ enforcement ã‚ã‚‹ã„ã¯ workflow ã®æ©Ÿèƒ½ãŒåœæ­¢ã™ã‚‹ã®ã¯æ®‹å¿µãªã¨ã“ã‚ã§ã™ã€‚

### ç²’åº¦ãŒè’ã„

ä¸Šè¨˜ composite action ã®ä»¶ã‚„ã€ä¸€éƒ¨ã®ä¿¡é ¼ã§ãã‚‹ action ã«ã¤ã„ã¦ã¯ bypass ã—ãŸã„ã€ã‚ã‚‹ã„ã¯ä¸€æ—¦ warning ãã‚‰ã„ã® level ã§å—ã‘å–ã‚ŠãŸã„ã€ãªã©ã¨ã„ã£ãŸãƒ‹ãƒ¼ã‚ºã‚‚ã‚ã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚

ç¾çŠ¶ã§ã¯ organization or repository ã®ç²’åº¦ã§ã—ã‹è¨­å®šã§ããšã€ã¾ãŸ error ã¨ã—ã¦ workflow ã®å®Ÿè¡Œã‚’æ­¢ã‚ã‚‹ã“ã¨ã—ã‹é¸æŠã§ãã¾ã›ã‚“ã€‚æ®µéšçš„ã«å°å…¥ã—ã¦ã„ãã«ã¯å°‘ã—ã¤ã‚‰ã„ã¨ã“ã‚ãŒã‚ã‚‹ã‚ˆã†ã«æ€ã„ã¾ã™ã€‚

è£œè¶³ã¨ã—ã¦ã€reusable workflow ã«ã¤ã„ã¦ã¯ tag ã§ã®æŒ‡å®šã‚‚è¨±å®¹ã•ã‚Œã‚‹ã‚ˆã†ã§ã™ï¼š

> When you enable Require actions to be pinned to a full-length commit SHA, all actions must be pinned to a full-length commit SHA to be used. This includes actions from your organization and actions authored by GitHub. Reusable workflows can still be referenced by tag.

https://docs.github.com/en/repositories/managing-your-repositorys-settings-and-features/enabling-features-for-your-repository/managing-github-actions-settings-for-a-repository#managing-github-actions-permissions-for-your-repository

ãŸã ã€Discussions ã«ã¯ `uses: ./.github/actions/argocd` ã®ã‚ˆã†ãª local path ã®åˆ©ç”¨ã‚‚ ban ã•ã‚Œã‚‹ã¨ã®å ±å‘ŠãŒã‚ã‚Šã€æ‡¸å¿µãŒæ®‹ã‚Šã¾ã™ã€‚

https://github.com/orgs/community/discussions/170337

## ç¾çŠ¶ã®ï¼ˆå€‹äººçš„ï¼‰æœ€é©è§£

ä»¥ä¸ŠãŒ Enforce SHA Pinning è¨­å®šã«ã¤ã„ã¦ã®ç¾æ™‚ç‚¹ã§ã®æŒ™å‹•ã§ã™ã€‚

çµå±€è‡ªå‹•ä¿®æ­£ãƒ»æ›´æ–°ã«ã¯ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ„ãƒ¼ãƒ«ãŒå¿…è¦ã§ã€ãã‚Œã‚‰ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ãˆã° enforcement ã‚‚é”æˆã§ãã¾ã™ã€‚

ã“ã‚Œã‚‰ã®äº‹æƒ…ã‚’é‘‘ã¿ã‚‹ã¨ã€ç¾çŠ¶ã§ã¯ã¾ã ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ„ãƒ¼ãƒ«ã‚’ç”¨ã„ã¦ enforcement ã‚’å®Ÿç¾ã™ã‚‹æ–¹ãŒæŸ”è»Ÿæ€§ãªã©ã®é¢ã‚’è€ƒæ…®ã—ã¦ã‚‚ã‚ˆã‚Šè‰¯ã„æ–¹é‡ã§ã‚ã‚‹ã‚ˆã†ã«æ˜ ã‚Šã¾ã™ã€‚

å¼Šç¤¾ã§ã‚‚ GitHub Actions åŠã³ pinact ã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹ã®ã§ã™ãŒã€è»½ãæ¤œè¨¼ã‚’è¡Œã£ãŸçµæœä»Šå›ã®æ©Ÿèƒ½ã¯æœ‰åŠ¹åŒ–ã›ãšç¾çŠ¶ç¶­æŒã§è¡Œã“ã†ã¨ã„ã†åˆ¤æ–­ã‚’ã—ã¾ã—ãŸã€‚

## ã¾ã¨ã‚

ä»¥ä¸Šã€Enforce SHA Pinning è¨­å®šã«ã¤ã„ã¦ç´¹ä»‹ã—ã¾ã—ãŸã€‚

ã‚ã’ã¤ã‚‰ã†æ ¼å¥½ã«ãªã£ã¦ã—ã¾ã„ã¾ã—ãŸãŒã€GitHub ã®æ©Ÿèƒ½ã¨ã—ã¦ SHA pinning ã‚’è³„ãˆã‚‹ã¨ã¨ã¦ã‚‚å¬‰ã—ã„ã®ã§ã€ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’çµŒã¦ä½¿ã„å¿ƒåœ°ã®ã„ã„ã‚‚ã®ã«ãªã£ã¦ãã‚Œã‚‹ã“ã¨ã‚’é¡˜ã„ã¾ã™ã€‚

:::message
ä½™è«‡ã§ã™ãŒã€Releasesã«ãŠã„ã¦immutabilityã‚’ä¿è¨¼ã™ã‚‹æ©Ÿèƒ½ãŒpublic previewã¨ã—ã¦å…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ï¼š https://github.blog/changelog/2025-08-26-releases-now-support-immutability-in-public-preview/

ã“ã‚Œã«ã‚ˆã‚Šã€releaseã«ç´ã¥ã‘ã‚‰ã‚Œã¦ã„ã‚‹assets/artifactsã‚„tagã®å¤‰æ›´ãƒ»å‰Šé™¤ãŒã§ããªããªã‚‹ã¨ã®ã“ã¨ã§ã™ã€‚ã“ã¡ã‚‰ã‚‚æ¥½ã—ã¿ãªæ©Ÿèƒ½ã§ã™ã€‚
:::

[^1]: https://docs.github.com/en/actions/reference/security/secure-use#using-third-party-actions
[^2]: åˆ©ç”¨ã—ã¦ã„ãŸ action ã«ä¿®æ­£ã‚’æŠ•ã’ãŸã¨ã“ã‚ã™ã‚“ãªã‚Š merge ã—ã¦ã‚‚ã‚‰ãˆã¾ã—ãŸ (âˆ©Â´âˆ€ï½€)âˆ©: https://github.com/actions-rust-lang/setup-rust-toolchain/pull/68
